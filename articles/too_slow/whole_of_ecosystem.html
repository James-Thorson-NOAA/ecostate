<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Whole of ecosystem model • ecostate</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Whole of ecosystem model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">ecostate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/too_slow/age_structured_interactions.html">Age-structured and bottom-up interactions</a></li>
    <li><a class="dropdown-item" href="../../articles/model-description.html">ecostate model description</a></li>
    <li><a class="dropdown-item" href="../../articles/model_of_intermediate_complexity.html">Model of Intermediate Complexity</a></li>
    <li><a class="dropdown-item" href="../../articles/not_on_cran/simulation.html">Demonstrating EcoState via simulation</a></li>
    <li><a class="dropdown-item" href="../../articles/not_on_cran/surplus_production.html">EcoState as surplus production model</a></li>
    <li><a class="dropdown-item" href="../../articles/too_slow/whole_of_ecosystem.html">Whole of ecosystem model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/James-Thorson-NOAA/ecostate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Whole of ecosystem model</h1>
                        <h4 data-toc-skip class="author">James
Thorson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/James-Thorson-NOAA/ecostate/blob/HEAD/vignettes/too_slow/whole_of_ecosystem.Rmd" class="external-link"><code>vignettes/too_slow/whole_of_ecosystem.Rmd</code></a></small>
      <div class="d-none name"><code>whole_of_ecosystem.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://james-thorson-noaa.github.io/ecostate/" class="external-link">ecostate</a></span><span class="op">)</span></span></code></pre></div>
<p><code>ecostate</code> is an R package for fitting the mass-balance
dynamics specified by EcoSim as a state-space model. We here demonstrate
how it can be fitted to an entire ecosystem, using inputs from a
previous Rpath model from Whitehouse et al. 2021, and fitting it to
biomass and catch time-series for pollock, cod, and arrowtooth.</p>
<div class="section level2">
<h2 id="eastern-bering-sea">Eastern Bering Sea<a class="anchor" aria-label="anchor" href="#eastern-bering-sea"></a>
</h2>
<p>We first load various inputs that are used by Rpath:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span> <span class="va">whitehouse_2021</span> <span class="op">)</span></span>
<span><span class="va">Ecopath</span> <span class="op">=</span> <span class="va">whitehouse_2021</span><span class="op">$</span><span class="va">Ecopath</span></span>
<span><span class="va">Diet</span> <span class="op">=</span> <span class="va">whitehouse_2021</span><span class="op">$</span><span class="va">Diet</span></span>
<span><span class="va">stanzas</span> <span class="op">=</span> <span class="va">whitehouse_2021</span><span class="op">$</span><span class="va">stanzas</span></span>
<span><span class="va">stanza_groups</span> <span class="op">=</span> <span class="va">whitehouse_2021</span><span class="op">$</span><span class="va">stanza_groups</span></span></code></pre></div>
<p>We also load time-series of surveys and catches that are used in the
MICE model demonstration:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span> <span class="va">eastern_bering_sea</span> <span class="op">)</span></span>
<span><span class="va">Catch</span> <span class="op">=</span> <span class="va">eastern_bering_sea</span><span class="op">$</span><span class="va">Catch</span></span>
<span><span class="va">catch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> <span class="st">"Year"</span><span class="op">=</span><span class="va">Catch</span><span class="op">$</span><span class="va">Year</span>, <span class="st">"Mass"</span><span class="op">=</span><span class="va">Catch</span><span class="op">$</span><span class="va">Mass</span>, <span class="st">"Taxon"</span><span class="op">=</span><span class="va">Catch</span><span class="op">$</span><span class="va">Taxon</span> <span class="op">)</span></span>
<span><span class="va">catch</span><span class="op">$</span><span class="va">Taxon</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">catch</span><span class="op">$</span><span class="va">Taxon</span>, FUN<span class="op">=</span><span class="va">switch</span>, <span class="st">"Arrowtooth"</span> <span class="op">=</span> <span class="st">"Arrowtooth flounder adult"</span>,</span>
<span>                                               <span class="st">"Cod"</span> <span class="op">=</span> <span class="st">"Pacific cod adult"</span>,</span>
<span>                                               <span class="st">"Pollock"</span> <span class="op">=</span> <span class="st">"Walleye pollock adult"</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="va">Fish</span> <span class="op">=</span> <span class="va">eastern_bering_sea</span><span class="op">$</span><span class="va">Survey</span></span>
<span><span class="va">biomass</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">"Mass"</span> <span class="op">=</span> <span class="va">Fish</span><span class="op">$</span><span class="va">Mass</span>,</span>
<span>  <span class="st">"Year"</span> <span class="op">=</span> <span class="va">Fish</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>  <span class="st">"Taxon"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">Fish</span><span class="op">$</span><span class="va">Taxon</span>, FUN<span class="op">=</span><span class="va">switch</span>, <span class="st">"Arrowtooth"</span> <span class="op">=</span> <span class="st">"Arrowtooth flounder adult"</span>,</span>
<span>                                              <span class="st">"Cod"</span> <span class="op">=</span> <span class="st">"Pacific cod adult"</span>,</span>
<span>                                              <span class="st">"Pollock"</span> <span class="op">=</span> <span class="st">"Walleye pollock adult"</span>,</span>
<span>                                              <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">biomass</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">biomass</span><span class="op">)</span></span></code></pre></div>
<p>We then reformat the various Rpath inputs. In particular, we
eliminate the pelagic detritus pool (because EcoState currently does not
allow more than one detritus functional group), and add
<code>benthic_detritus</code> to the Ecopath inputs (because Ecopath
solves for equilibrium values for detritus jointly with other
groups):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="va">which_ecopath</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Ecopath</span><span class="op">)</span>, <span class="fl">66</span><span class="op">)</span></span>
<span><span class="va">taxa</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">Ecopath</span><span class="op">[</span><span class="va">which_ecopath</span>,<span class="st">'Functional.group'</span><span class="op">]</span>, <span class="st">"benthic_detritus"</span> <span class="op">)</span></span>
<span><span class="va">type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">taxa</span>, FUN <span class="op">=</span> <span class="va">switch</span>, </span>
<span>                     <span class="st">"benthic_detritus"</span> <span class="op">=</span> <span class="st">"detritus"</span>, </span>
<span>                     <span class="st">"Large phytoplankton"</span> <span class="op">=</span> <span class="st">"auto"</span>, </span>
<span>                     <span class="st">"Small phytoplankton"</span> <span class="op">=</span> <span class="st">"auto"</span>, </span>
<span>                     <span class="st">"hetero"</span> <span class="op">)</span></span>
<span><span class="va">PB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">Ecopath</span><span class="op">[</span><span class="va">which_ecopath</span>,<span class="st">'P.B'</span><span class="op">]</span>, <span class="fl">0.5</span> <span class="op">)</span></span>
<span><span class="va">QB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">Ecopath</span><span class="op">[</span><span class="va">which_ecopath</span>,<span class="st">'Q.B'</span><span class="op">]</span>, <span class="cn">NA</span> <span class="op">)</span></span>
<span><span class="va">B</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">Ecopath</span><span class="op">[</span><span class="va">which_ecopath</span>,<span class="st">'Biomass'</span><span class="op">]</span>, <span class="cn">NA</span> <span class="op">)</span></span>
<span><span class="va">EE</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">Ecopath</span><span class="op">[</span><span class="va">which_ecopath</span>,<span class="st">'EE'</span><span class="op">]</span>, <span class="fl">0.5</span> <span class="op">)</span></span>
<span><span class="va">U</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">which_ecopath</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Modify EE</span></span>
<span><span class="va">EE</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="va">taxa</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"benthic_detritus"</span>,<span class="st">"Walleye pollock adult"</span><span class="op">)</span>, <span class="va">EE</span>, <span class="cn">NA</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># </span></span>
<span><span class="va">which_cols</span> <span class="op">=</span> <span class="va">which_ecopath</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="va">which_rows</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">which_ecopath</span>, <span class="fl">72</span> <span class="op">)</span></span>
<span><span class="va">DC</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">Diet</span><span class="op">[</span><span class="va">which_rows</span>, <span class="va">which_cols</span><span class="op">]</span>, <span class="st">"benthic_detritus"</span><span class="op">=</span><span class="fl">0</span> <span class="op">)</span></span>
<span><span class="va">DC</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">DC</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">DC</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">2</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">taxa</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="va">stgroups</span> <span class="op">=</span> <span class="va">stanza_groups</span><span class="op">[</span>,<span class="st">'StanzaGroup'</span><span class="op">]</span><span class="op">[</span><span class="va">stanzas</span><span class="op">[</span>,<span class="st">'StGroupNum'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">Amax</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="op">(</span><span class="va">stanzas</span><span class="op">[</span>,<span class="st">'Last'</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="va">K</span> <span class="op">=</span> <span class="va">stanza_groups</span><span class="op">[</span>,<span class="st">'VBGF_Ksp'</span><span class="op">]</span></span>
<span><span class="va">d</span> <span class="op">=</span> <span class="va">stanza_groups</span><span class="op">[</span>,<span class="st">'VBGF_d'</span><span class="op">]</span></span>
<span><span class="va">Wmat</span> <span class="op">=</span> <span class="va">stanza_groups</span><span class="op">[</span>,<span class="st">'Wmat'</span><span class="op">]</span></span>
<span><span class="va">SpawnX</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PB</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">QB</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">EE</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span> <span class="op">=</span> <span class="va">taxa</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">DC</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">taxa</span>, <span class="va">taxa</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Amax</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">stgroups</span><span class="op">)</span> <span class="op">=</span> <span class="va">taxa</span><span class="op">[</span><span class="va">stanzas</span><span class="op">[</span>,<span class="st">'GroupNum'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Wmat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">SpawnX</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">stgroups</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Eliminate juvenile values</span></span>
<span><span class="va">which_juv</span> <span class="op">=</span> <span class="va">stanzas</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">stanzas</span><span class="op">[</span>,<span class="st">'Leading'</span><span class="op">]</span><span class="op">)</span>,<span class="st">'GroupNum'</span><span class="op">]</span></span>
<span><span class="va">QB</span><span class="op">[</span><span class="va">which_juv</span><span class="op">]</span> <span class="op">=</span> <span class="va">B</span><span class="op">[</span><span class="va">which_juv</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span></span></code></pre></div>
<p>We then specify which parameters to estimate:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit catchability coefficient for adult pollock</span></span>
<span><span class="va">fit_Q</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"Walleye pollock adult"</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># fit equilibrium biomass for adult arrowtooth and cod</span></span>
<span><span class="va">fit_B</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"Arrowtooth flounder adult"</span>, <span class="st">"Pacific cod adult"</span> <span class="op">)</span></span></code></pre></div>
<p>Finally, we will build inputs without running the model, modify the
TMB <code>map</code> manually, and then estimate parameters</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span> <span class="va">map</span>, <span class="va">nlminb_loops</span>, <span class="va">getsd</span> <span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="../../reference/ecostate.html">ecostate</a></span><span class="op">(</span></span>
<span>    taxa <span class="op">=</span> <span class="va">taxa</span>,</span>
<span>    years <span class="op">=</span> <span class="fl">1981</span><span class="op">:</span><span class="fl">2020</span>,</span>
<span>    catch <span class="op">=</span> <span class="va">catch</span>,</span>
<span>    biomass <span class="op">=</span> <span class="va">biomass</span>,</span>
<span>    PB <span class="op">=</span> <span class="va">PB</span>,</span>
<span>    QB <span class="op">=</span> <span class="va">QB</span>,</span>
<span>    DC <span class="op">=</span> <span class="va">DC</span>,</span>
<span>    B <span class="op">=</span> <span class="va">B</span>,</span>
<span>    EE <span class="op">=</span> <span class="va">EE</span>,</span>
<span>    X <span class="op">=</span> <span class="va">X</span>,</span>
<span>    type <span class="op">=</span> <span class="va">type</span>,</span>
<span>    U <span class="op">=</span> <span class="va">U</span>,</span>
<span>    fit_B <span class="op">=</span> <span class="va">fit_B</span>,</span>
<span>    fit_Q <span class="op">=</span> <span class="va">fit_Q</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="../../reference/ecostate_control.html">ecostate_control</a></span><span class="op">(</span> nlminb_loops <span class="op">=</span> <span class="va">nlminb_loops</span>,</span>
<span>                                getsd <span class="op">=</span> <span class="va">getsd</span>,</span>
<span>                                n_steps <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                                profile <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                random <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                map <span class="op">=</span> <span class="va">map</span>,</span>
<span>                                start_tau <span class="op">=</span> <span class="fl">0.1</span> <span class="op">)</span>,</span>
<span>    settings <span class="op">=</span> <span class="fu"><a href="../../reference/stanza_settings.html">stanza_settings</a></span><span class="op">(</span></span>
<span>      taxa <span class="op">=</span> <span class="va">taxa</span>,</span>
<span>      stanza_groups <span class="op">=</span> <span class="va">stgroups</span>,</span>
<span>      K <span class="op">=</span> <span class="va">K</span>,</span>
<span>      Wmat <span class="op">=</span> <span class="va">Wmat</span>,</span>
<span>      d <span class="op">=</span> <span class="va">d</span>,</span>
<span>      Amax <span class="op">=</span> <span class="va">Amax</span>,</span>
<span>      SpawnX <span class="op">=</span> <span class="va">SpawnX</span>,</span>
<span>      STEPS_PER_YEAR <span class="op">=</span> <span class="fl">12</span> <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">out0</span> <span class="op">=</span> <span class="fu">run</span><span class="op">(</span> map <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>           nlminb_loops <span class="op">=</span> <span class="fl">0</span>,</span>
<span>           getsd <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">)</span></span>
<span><span class="va">map</span> <span class="op">=</span> <span class="va">out0</span><span class="op">$</span><span class="va">tmb_inputs</span><span class="op">$</span><span class="va">map</span></span>
<span>  <span class="va">map</span><span class="op">$</span><span class="va">logtau_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">map</span><span class="op">$</span><span class="va">logtau_i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">=</span> <span class="fu">run</span><span class="op">(</span> map <span class="op">=</span> <span class="va">map</span>,</span>
<span>           nlminb_loops <span class="op">=</span> <span class="fl">1</span>,</span>
<span>           getsd <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
<p>We can compare equilibrium biomass between packages. These are
identical for many taxa (because) we specify the same values for biomass
for many taxa, and also differ for arrowtooth and cod because we are
estimating equilibrium biomass for these two taxa:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># runtime</span></span>
<span><span class="va">out</span><span class="op">$</span><span class="va">run_time</span></span>
<span><span class="co">#&gt; Time difference of 24.33986 mins</span></span>
<span></span>
<span><span class="co"># Compile stuff</span></span>
<span><span class="va">Borig</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">Ecopath</span><span class="op">[</span><span class="va">which_ecopath</span>,<span class="st">'Biomass'</span><span class="op">]</span>, <span class="cn">NA</span> <span class="op">)</span></span>
<span><span class="va">Bhat</span> <span class="op">=</span> <span class="fu"><a href="../../reference/print_ecopars.html">print_ecopars</a></span><span class="op">(</span><span class="va">out</span>, silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="st">'B'</span><span class="op">]</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> <span class="va">taxa</span>, </span>
<span>                 <span class="st">"Whitehouse"</span> <span class="op">=</span> <span class="va">Borig</span>, </span>
<span>                 <span class="st">"EcoState"</span> <span class="op">=</span> <span class="va">Bhat</span>, </span>
<span>                 <span class="st">"Difference"</span> <span class="op">=</span> <span class="va">Bhat</span> <span class="op">-</span> <span class="va">Borig</span> <span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span> <span class="va">df</span>, digits<span class="op">=</span><span class="fl">3</span> <span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">taxa</th>
<th align="right">Whitehouse</th>
<th align="right">EcoState</th>
<th align="right">Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Transient killer whales</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Toothed whales</td>
<td align="right">0.035</td>
<td align="right">0.035</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Gray whales</td>
<td align="right">0.033</td>
<td align="right">0.033</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Baleen whales</td>
<td align="right">0.508</td>
<td align="right">0.508</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Pinnipeds</td>
<td align="right">0.016</td>
<td align="right">0.016</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Walrus and bearded seals</td>
<td align="right">0.114</td>
<td align="right">0.114</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Northern fur seal juvenile</td>
<td align="right">0.001</td>
<td align="right">0.001</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Northern fur seal adult</td>
<td align="right">0.033</td>
<td align="right">0.033</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Ice seals</td>
<td align="right">0.030</td>
<td align="right">0.030</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Other birds</td>
<td align="right">0.001</td>
<td align="right">0.001</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Murres and puffins</td>
<td align="right">0.009</td>
<td align="right">0.009</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Kittiwakes</td>
<td align="right">0.001</td>
<td align="right">0.001</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Auklets</td>
<td align="right">0.002</td>
<td align="right">0.002</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Fulmars</td>
<td align="right">0.000</td>
<td align="right">0.001</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Albatross</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Sharks</td>
<td align="right">0.053</td>
<td align="right">0.053</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Walleye pollock juvenile</td>
<td align="right">4.567</td>
<td align="right">4.590</td>
<td align="right">0.023</td>
</tr>
<tr class="even">
<td align="left">Walleye pollock adult</td>
<td align="right">18.486</td>
<td align="right">18.486</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Pacific cod juvenile</td>
<td align="right">0.187</td>
<td align="right">0.164</td>
<td align="right">-0.023</td>
</tr>
<tr class="even">
<td align="left">Pacific cod adult</td>
<td align="right">2.465</td>
<td align="right">2.183</td>
<td align="right">-0.282</td>
</tr>
<tr class="odd">
<td align="left">Herring</td>
<td align="right">0.783</td>
<td align="right">0.783</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Arrowtooth flounder juvenile</td>
<td align="right">0.008</td>
<td align="right">0.013</td>
<td align="right">0.004</td>
</tr>
<tr class="odd">
<td align="left">Arrowtooth flounder adult</td>
<td align="right">0.944</td>
<td align="right">0.420</td>
<td align="right">-0.525</td>
</tr>
<tr class="even">
<td align="left">Kamchatka flounder</td>
<td align="right">0.056</td>
<td align="right">0.056</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Greenland turbot juvenile</td>
<td align="right">0.007</td>
<td align="right">0.007</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Greenland turbot adult</td>
<td align="right">0.349</td>
<td align="right">0.349</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Pacific halibut juvenile</td>
<td align="right">0.002</td>
<td align="right">0.002</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Pacific halibut adult</td>
<td align="right">0.222</td>
<td align="right">0.222</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Yellowfin sole</td>
<td align="right">5.258</td>
<td align="right">5.258</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Flathead sole</td>
<td align="right">1.341</td>
<td align="right">1.341</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Northern rock sole</td>
<td align="right">3.383</td>
<td align="right">3.383</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Alaska plaice</td>
<td align="right">1.068</td>
<td align="right">1.068</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Other flatfish</td>
<td align="right">0.262</td>
<td align="right">0.262</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Skates</td>
<td align="right">0.773</td>
<td align="right">0.773</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Sablefish</td>
<td align="right">0.035</td>
<td align="right">0.035</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Eelpouts</td>
<td align="right">2.372</td>
<td align="right">2.372</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Deep demersal fish</td>
<td align="right">0.976</td>
<td align="right">0.976</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Pacific Ocean perch</td>
<td align="right">0.167</td>
<td align="right">0.167</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Other rockfish</td>
<td align="right">0.018</td>
<td align="right">0.018</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Northern rockfish</td>
<td align="right">0.028</td>
<td align="right">0.028</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Shortraker rockfish</td>
<td align="right">0.010</td>
<td align="right">0.010</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Rougheye rockfish</td>
<td align="right">0.004</td>
<td align="right">0.004</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Atka mackerel</td>
<td align="right">0.144</td>
<td align="right">0.144</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Shallow demersal fish</td>
<td align="right">2.306</td>
<td align="right">2.306</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Large sculpins</td>
<td align="right">0.540</td>
<td align="right">0.540</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Octopi</td>
<td align="right">0.192</td>
<td align="right">0.193</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Squids</td>
<td align="right">0.927</td>
<td align="right">0.927</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Salmon returning</td>
<td align="right">0.164</td>
<td align="right">0.164</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Salmon smolts</td>
<td align="right">0.014</td>
<td align="right">0.014</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Myctophids and Bathylagids</td>
<td align="right">0.988</td>
<td align="right">0.988</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Capelin</td>
<td align="right">1.245</td>
<td align="right">1.245</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Sandlance</td>
<td align="right">2.528</td>
<td align="right">2.528</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Other forage fish</td>
<td align="right">2.102</td>
<td align="right">2.102</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Tanner crab (C. bairdi )</td>
<td align="right">0.522</td>
<td align="right">0.522</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">King crabs</td>
<td align="right">0.238</td>
<td align="right">0.238</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Snow crab (C. opilio)</td>
<td align="right">2.179</td>
<td align="right">2.179</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Pandalid shrimp</td>
<td align="right">6.742</td>
<td align="right">6.743</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Benthic zooplankton</td>
<td align="right">35.885</td>
<td align="right">35.885</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Motile epifauna</td>
<td align="right">9.880</td>
<td align="right">9.880</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Structural epifauna</td>
<td align="right">0.781</td>
<td align="right">0.781</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Infauna</td>
<td align="right">87.230</td>
<td align="right">87.230</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Jellyfish</td>
<td align="right">1.112</td>
<td align="right">1.112</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Pelagic zooplankton</td>
<td align="right">2.643</td>
<td align="right">2.643</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Euphausiids</td>
<td align="right">17.831</td>
<td align="right">17.831</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Copepods</td>
<td align="right">26.857</td>
<td align="right">26.857</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Benthic microbes</td>
<td align="right">22.061</td>
<td align="right">22.061</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Large phytoplankton</td>
<td align="right">9.100</td>
<td align="right">9.100</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Small phytoplankton</td>
<td align="right">39.504</td>
<td align="right">39.504</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">benthic_detritus</td>
<td align="right">NA</td>
<td align="right">12695.821</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>Runtime for this vignette: 25.27 mins</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
